function MarkerClusterer(a,b,c){this.extend(MarkerClusterer,google.maps.OverlayView),this.map_=a,this.markers_=[],this.clusters_=[],this.sizes=[53,56,66,78,90],this.styles_=[],this.ready_=!1;this.gridSize_=60,this.minClusterSize_=2,this.maxZoom_=null,this.styles_=[],this.imagePath_=this.MARKER_CLUSTER_IMAGE_PATH_,this.imageExtension_=this.MARKER_CLUSTER_IMAGE_EXTENSION_,this.zoomOnClick_=!0,this.averageCenter_=!1,this.setupStyles_(),this.setMap(a),this.prevZoom_=this.map_.getZoom();var d=this;google.maps.event.addListener(this.map_,"zoom_changed",function(){var a=d.map_.getZoom();d.prevZoom_!=a&&(d.prevZoom_=a,d.resetViewport())}),google.maps.event.addListener(this.map_,"idle",function(){d.redraw()}),b&&b.length&&this.addMarkers(b,!1)}function Cluster(a){this.markerClusterer_=a,this.map_=a.getMap(),this.gridSize_=a.getGridSize(),this.minClusterSize_=a.getMinClusterSize(),this.averageCenter_=a.isAverageCenter(),this.center_=null,this.markers_=[],this.bounds_=null,this.clusterIcon_=new ClusterIcon(this,a.getStyles(),a.getGridSize())}function ClusterIcon(a,b,c){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView),this.styles_=b,this.padding_=c||0,this.cluster_=a,this.center_=null,this.map_=a.getMap(),this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(this.map_)}var app=angular.module("mapsApp",["ui.bootstrap","ngAnimate"]),module=angular.module("mapsApp");module.factory("mapsProp",["$http",function(a){var b,c,d={},e=function(b,c,d,e){var f={filters:{and:[{geoDistance:{geo:{distance:parseFloat(e),lat:b,lon:c,minDistance:parseFloat(d)}}}]},paging:{start:0,rows:200},fields:[]};f=JSON.stringify(f);var g="https://www.proptiger.com/app/v2/project-listing?selector=";return a.get(g+f).then(function(a){return a.data})},f=function(b){var c=localStorage.getItem("city");return a.get("https://www.proptiger.com/columbus/app/v4/typeahead?query="+b+"&typeAheadType=LOCALITY,SUBURB&rows=25&city="+c).then(function(a){return a.data})},g=function(a,b,c,d,e,f){function g(a,g){if(g==google.maps.DistanceMatrixStatus.OK){h={distance:a.rows[0].elements[0].distance,duration:a.rows[0].elements[0].duration};var i=f||b.name;i==f?(i+=" (Source)",e.setContent("<div><strong>"+i+"</strong></div>"),e.open(d.map,c)):(e.setContent("<div><strong>"+i+"</strong><br>Distance :"+h.distance.text+"  Time :"+h.duration.text+"</div>"),e.open(d.map,c))}}var h={},i=new google.maps.LatLng(a.latitude,a.longitude),j=new google.maps.LatLng(b.latitude,b.longitude),k=new google.maps.DistanceMatrixService;k.getDistanceMatrix({origins:[i],destinations:[j],travelMode:google.maps.TravelMode.DRIVING},g)},h=function(a){d=a},i=function(){var a=d;return d=[],a},j=function(a){b=a},k=function(){return b},l=function(a){c=a},m=function(){return c};return{setTimeLayer:h,getTimeLayer:i,setDeferredObject:l,getDeferredObject:m,getProjects:e,getTypeDownData:f,getDistTime:g,setMessage:j,getMessage:k}}]);var app=angular.module("mapsApp");app.controller("searchCtrl",["$scope","mapsProp","$rootScope","PtMapsConfig",function(a,b,c,d){a.cities=["Gurgaon","Bangalore","Mumbai","Pune"],a.message="";a.time=[];for(var e=0;e<d.travelHeatMapConfig.timeSequence.length;e++)a.time.push(d.travelHeatMapConfig.timeSequence[e]);a.setCity=function(b){a.searchResults=[],localStorage.setItem("city",b)},a.message=b.getMessage();var f,g;a.setProject=function(b){a.string=b.coreText,g=b,a.searchResults=[],a.tab=2},c.$on("showMessage",function(b,c){a.message=c.messageContent}),a.setValTime=function(b){console.log(b.add[0].range),f=b.add[0].range,a.updateCompletion=""},a.updateCompletion="",c.$on("showUpdateProgress",function(b,c){a.updateCompletion=100*c.val.angle/(2*Math.PI)}),a.search=function(c){a.searchResults=[],b.getTypeDownData(c).then(function(b){a.searchResults=b.data,console.log(a.searchResults.length),0==a.searchResults.length&&c?a.message="No results returned":a.message=""})},a.find=function(){a.message="",a.searchResults=[],a.searchResults.push(g);var b={time:f};localStorage.setItem("timetype",JSON.stringify(b)),localStorage.setItem("project",JSON.stringify(g)),c.$broadcast("positionSuccess",{})}}]),app.directive("search",function(){return{templateUrl:"templates/search.html",controller:"searchCtrl"}});var app=angular.module("mapsApp");app.controller("showMapCtrl",["$scope","mapsProp","$rootScope","timeSenseService","$q","PtMapsConfig",function(a,b,c,d,e,f){a.n="";var g,h,i,j,k=[],l=[],m=28.443,n=77.05;i=new google.maps.InfoWindow;var o={center:{lat:m,lng:n},zoom:8},p=function(a,b){for(var c=-1,d=0;d<b.length;d++){var e=f.distanceBetweenPoints(a,b[d]);e>c&&(c=e)}return c};a.map=new google.maps.Map(document.getElementById("map"),o),j=a.map;var q,r,s=function(a){var b=a.time.split("-"),c=b[1];return c},t=function(){function c(a){m=b.getTimeLayer();for(var c=[],d=0;d<m[r].length;d++)c[d]={lat:m[r][d].latitude,lng:m[r][d].longitude};u(c);var e={lat:g.latitude,lng:g.longitude};l=p(e,c),i=0,k=b.getProjects(g.latitude,g.longitude,i,l),k.then(function(a){k=a.data,k=k.items,w(k,c)})}function f(a){console.log(m)}v=new google.maps.LatLngBounds,a.map=new google.maps.Map(document.getElementById("map"),o),j=a.map,g=localStorage.getItem("project"),g=JSON.parse(g);var i,l;h=localStorage.getItem("timetype"),h=JSON.parse(h),window.localStorage.clear();new google.maps.LatLng(g.latitude,g.longitude);if(h){var m;r=s(h),r=parseInt(r,10);var n=e.defer();b.setDeferredObject(n),n.promise.then(c,f),d.drawTimeSense(r,g)}y(g,"red")},u=function(a){console.log("polygon printed"),q=new google.maps.Polygon({paths:a,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35}),q.setMap(j)},v=new google.maps.LatLngBounds,w=function(a,b){for(var d=0;d<l.length;d++)l[d].setMap(null);l=[],y(g,"red"),console.log(g);var e=0;for(d=0;d<a.length;d++){var f=new google.maps.LatLng(a[d].latitude,a[d].longitude);a[d].latitude!=g.latitude&&q.containsLatLng(f)&&(y(a[d],"blue"),e=1)}new MarkerClusterer(j,l);e?j.fitBounds(v):c.$broadcast("showMessage",{messageContent:"no markers reachable within "+r+" minutes"}),l.push(projectMarker)},x=function(c,d,e,f){google.maps.event.addListener(e,"mouseover",function(){b.getDistTime(c,d,this,a,i,f)}),google.maps.event.addListener(e,"mouseout",function(){i.close(a.map,i)})},y=function(a,b){var c,d=new google.maps.Marker({position:new google.maps.LatLng(a.latitude,a.longitude),icon:"http://maps.google.com/mapfiles/ms/icons/"+b+"-dot.png"});"red"==b&&(d.setMap(j),projectMarker=d,c=a.entityName),"red"!=b&&l.push(d),v.extend(d.getPosition()),x(g,a,d,c)};c.$on("positionSuccess",function(){t()})}]),app.directive("maps",function(){return{templateUrl:"templates/showMap.html",controller:"showMapCtrl"}});var app=angular.module("mapsApp");app.factory("PtMapsConfig",[function(){var a={V_HIGH:Math.PI/24,HIGH:Math.PI/12,MEDIUM:Math.PI/6,LOW:Math.PI/4},b={directions:[{direction:"EAST",lat:.5,lng:0},{direction:"WEST",lat:-.5,lng:0},{direction:"NORTH",lat:0,lng:.5},{direction:"SOUTH",lat:0,lng:-.5}],delta:.5,timeLimit:30,repeatThreshHold:4,stepOutThreshold:4,fitBoundTimeKey:30,fitBoundRange:"20-30",timeSequence:[{time:10,degree:a.MEDIUM,add:[{range:"0-10",limits:[10],fillColor:"#86b927",strokeColor:"#86b927",fillOpacity:.35,strokeOpacity:.5,strokeWeight:.1}]},{time:20,degree:a.HIGH,add:[{range:"0-20",limits:[0,20],fillColor:"#bfb51d",strokeColor:"#bfb51d",fillOpacity:.35,strokeOpacity:.5,strokeWeight:.1}]},{time:30,degree:a.HIGH,add:[{range:"0-30",limits:[0,30],fillColor:"#b25317",strokeColor:"#b25317",fillOpacity:.35,strokeOpacity:.5,strokeWeight:.1}]}]},c=function(a,b){if(!a||!b)return 0;var c=6371,d=(b.lat-a.lat)*Math.PI/180,e=(b.lng-a.lng)*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat*Math.PI/180)*Math.cos(b.lat*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h};return{distanceBetweenPoints:c,travelHeatMapConfig:b}}]);var app=angular.module("mapsApp");app.factory("mapDistanceMatrix",["$q",function(a){var b,c={};return c.fetch=function(c,d){b=new google.maps.DistanceMatrixService;var e,f=new google.maps.LatLng(c.latitude,c.longitude),g=new google.maps.LatLng(d.latitude,d.longitude),h={origins:[f],destinations:[g],travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},i=a.defer();return b.getDistanceMatrix(h,function(a,b){e=b===google.maps.DistanceMatrixStatus.OK?{status:"OK",results:a}:{status:"ERROR",msg:"Error fetching results"},i.resolve(e)}),i.promise},c}]);var app=angular.module("mapsApp");app.factory("timeSenseService",["$q","PtMapsConfig","$rootScope","mapDistanceMatrix","mapsProp",function(a,b,c,d,e){function f(a,c,d){var e,f,h,i=b.travelHeatMapConfig;a<i.timeSequence.length?(h=i.timeSequence[a],e=h.degree,f=h.time,g(c,f,0,e,d,a)):n.resolve()}function g(a,c,d,e,f,g){var i,j;b.travelHeatMapConfig.timeSequence[g];d<2*Math.PI?(i=c*f*.8,j={latitude:a.latitude+i*Math.cos(d),longitude:a.longitude+i*Math.sin(d)},h(a,j,c,d,e,f,g,0)):n.resolve()}function h(a,b,c,e,f,g,h,l){d.fetch(a,b).then(function(d){if("ERROR"===d.status)return void n.reject(d);if(d.results.rows[0].elements[0].duration){var m,o;m=d.results.rows[0].elements[0].duration.text.split(" "),o=4===m.length?60*parseInt(m[0])+parseInt(m[2]):parseInt(m[0]),j(o,c,a,b,e,f,g,h,l)}else{var p,q,r,s,t,u,v,w,x,y=Object.keys(k),z=1/0,A=new google.maps.LatLng(b.latitude,b.longitude);if(!(y.length>1))return void n.reject(d);r=100;for(w in y)s=c-y[w],s>0&&r>s&&(r=s,q=y[w]);for(p=k[q],w=0,x=p.length;x>w;w++)v=new google.maps.LatLng(p[w].latitude,p[w].longitude),t=google.maps.geometry.spherical.computeDistanceBetween(A,v),z>t&&(z=t,u=w);b=i(b)?{latitude:p[u].latitude+g*Math.cos(e),longitude:p[u].longitude+g*Math.sin(e)}:{latitude:(b.latitude+p[u].latitude)/2,longitude:(b.longitude+p[u].longitude)/2},j(c,c,a,b,e,f,g,h,0)}})}function i(a){var b=new google.maps.LatLng(a.latitude,a.longitude),c=!1;for(var d in l)if(google.maps.geometry.poly.containsLocation(b,l[d].mapPolygon)){c=!0;break}return c}function j(a,d,e,f,j,l,n,p,q){var r,s=1,t=a-d,u=Math.abs(t);if(m)if(t>2)s=15>=d?1:Math.log2(a-d),r=n*s,f.latitude=f.latitude-r*Math.cos(j),f.longitude=f.longitude-r*Math.sin(j),setTimeout(function(){h(e,f,d,j,l,n,p,q)},100);else{if(u>2){if(d===b.travelHeatMapConfig.timeLimit&&q<=b.travelHeatMapConfig.repeatThreshHold)return s=Math.log2(u),r=n*s,f.latitude=f.latitude+r*Math.cos(j),f.longitude=f.longitude+r*Math.sin(j),void setTimeout(function(){h(e,f,d,j,l,n,p,q+1)},100);if(i(f))for(var v=0;v<b.travelHeatMapConfig.stepOutThreshold&&(f.latitude=f.latitude+2*n*Math.cos(j),f.longitude=f.longitude+2*n*Math.sin(j),i(f));v++);else f.latitude=f.latitude+2*n*Math.cos(j),f.longitude=f.longitude+2*n*Math.sin(j)}i(f)&&(o=!0),k[d]=k[d]||[],k[d].push(f),j+=l,c.$broadcast("showUpdateProgress",{val:{angle:j}}),g(e,d,j,l,n,p)}}var k,l,m,n,o,p,q={};Math.log2=Math.log2||function(a){return Math.log(a)/Math.log(2)};var r=function(c,g){var h,i,j,r,s=[],t=b.travelHeatMapConfig,u=t.directions,v={latitude:g.latitude,longitude:g.longitude};for(i=0,r=u.length;r>i;i++)h={latitude:v.latitude+u[i].lat,longitude:v.longitude+u[i].lng},s.push(d.fetch(v,h));p=(new Date).getTime(),a.all(s).then(function(b){var d,g,h=0,i=0,p=0;for(n=a.defer(),m=!0,k={},l={},q={},o=!1,n.promise.then(function(a){var b=e.getDeferredObject();return e.setTimeLayer(k),b.resolve(),k},function(a){m=!1,k=void 0,console.log(a)}),j=0,r=b.length;r>j;j++)"OK"===b[j].status&&b[j].results.rows[0].elements[0].duration&&(d=b[j].results.rows[0].elements[0].duration.text.split(" "),g=4===d.length?60*parseInt(d[0])+parseInt(d[2]):parseInt(d[0]),g&&(i+=1/g),p+=1);if(!p)return void n.reject("Count :"+p);h=t.delta*i/p;var s;switch(c=parseInt(c,10)){case 10:s=0;break;case 20:s=1;break;case 30:s=2;break;default:s=0}f(s,v,h)})};return{drawTimeSense:r}}]),MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_="https://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m",MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png",MarkerClusterer.prototype.extend=function(a,b){return function(a){for(var b in a.prototype)this.prototype[b]=a.prototype[b];return this}.apply(a,[b])},MarkerClusterer.prototype.onAdd=function(){this.setReady_(!0)},MarkerClusterer.prototype.draw=function(){},MarkerClusterer.prototype.setupStyles_=function(){if(!this.styles_.length)for(var a,b=0;a=this.sizes[b];b++)this.styles_.push({url:this.imagePath_+1+"."+this.imageExtension_,height:a,width:a})},MarkerClusterer.prototype.fitMapToMarkers=function(){for(var a,b=this.getMarkers(),c=new google.maps.LatLngBounds,d=0;a=b[d];d++)c.extend(a.getPosition());this.map_.fitBounds(c)},MarkerClusterer.prototype.setStyles=function(a){this.styles_=a},MarkerClusterer.prototype.getStyles=function(){return this.styles_},MarkerClusterer.prototype.isZoomOnClick=function(){return this.zoomOnClick_},MarkerClusterer.prototype.isAverageCenter=function(){return this.averageCenter_},MarkerClusterer.prototype.getMarkers=function(){return this.markers_},MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length},MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a},MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_},MarkerClusterer.prototype.calculator_=function(a,b){for(var c=0,d=a.length,e=d;0!==e;)e=parseInt(e/10,10),c++;return c=Math.min(c,b),{text:d,index:c}},MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a},MarkerClusterer.prototype.getCalculator=function(){return this.calculator_},MarkerClusterer.prototype.addMarkers=function(a,b){for(var c,d=0;c=a[d];d++)this.pushMarkerTo_(c);b||this.redraw()},MarkerClusterer.prototype.pushMarkerTo_=function(a){if(a.isAdded=!1,a.draggable){var b=this;google.maps.event.addListener(a,"dragend",function(){a.isAdded=!1,b.repaint()})}this.markers_.push(a)},MarkerClusterer.prototype.addMarker=function(a,b){this.pushMarkerTo_(a),b||this.redraw()},MarkerClusterer.prototype.removeMarker_=function(a){var b=-1;if(this.markers_.indexOf)b=this.markers_.indexOf(a);else for(var c,d=0;c=this.markers_[d];d++)if(c==a){b=d;break}return-1==b?!1:(a.setMap(null),this.markers_.splice(b,1),!0)},MarkerClusterer.prototype.removeMarker=function(a,b){var c=this.removeMarker_(a);return!b&&c?(this.resetViewport(),this.redraw(),!0):!1},MarkerClusterer.prototype.removeMarkers=function(a,b){for(var c,d=!1,e=0;c=a[e];e++){var f=this.removeMarker_(c);d=d||f}return!b&&d?(this.resetViewport(),this.redraw(),!0):void 0},MarkerClusterer.prototype.setReady_=function(a){this.ready_||(this.ready_=a,this.createClusters_())},MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length},MarkerClusterer.prototype.getMap=function(){return this.map_},MarkerClusterer.prototype.setMap=function(a){this.map_=a},MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_},MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a},MarkerClusterer.prototype.getMinClusterSize=function(){return this.minClusterSize_},MarkerClusterer.prototype.setMinClusterSize=function(a){this.minClusterSize_=a},MarkerClusterer.prototype.getExtendedBounds=function(a){var b=this.getProjection(),c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),d=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),e=b.fromLatLngToDivPixel(c);e.x+=this.gridSize_,e.y-=this.gridSize_;var f=b.fromLatLngToDivPixel(d);f.x-=this.gridSize_,f.y+=this.gridSize_;var g=b.fromDivPixelToLatLng(e),h=b.fromDivPixelToLatLng(f);return a.extend(g),a.extend(h),a},MarkerClusterer.prototype.isMarkerInBounds_=function(a,b){return b.contains(a.getPosition())},MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers_=[]},MarkerClusterer.prototype.resetViewport=function(a){for(var b,c=0;b=this.clusters_[c];c++)b.remove();for(var d,c=0;d=this.markers_[c];c++)d.isAdded=!1,a&&d.setMap(null);this.clusters_=[]},MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_.length=0,this.resetViewport(),this.redraw(),window.setTimeout(function(){for(var b,c=0;b=a[c];c++)b.remove()},0)},MarkerClusterer.prototype.redraw=function(){this.createClusters_()},MarkerClusterer.prototype.distanceBetweenPoints_=function(a,b){if(!a||!b)return 0;var c=6371,d=(b.lat()-a.lat())*Math.PI/180,e=(b.lng()-a.lng())*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h},MarkerClusterer.prototype.addToClosestCluster_=function(a){for(var b,c=4e4,d=null,e=(a.getPosition(),0);b=this.clusters_[e];e++){var f=b.getCenter();if(f){var g=this.distanceBetweenPoints_(f,a.getPosition());c>g&&(c=g,d=b)}}if(d&&d.isMarkerInClusterBounds(a))d.addMarker(a);else{var b=new Cluster(this);b.addMarker(a),this.clusters_.push(b)}},MarkerClusterer.prototype.createClusters_=function(){if(this.ready_)for(var a,b=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),c=this.getExtendedBounds(b),d=0;a=this.markers_[d];d++)!a.isAdded&&this.isMarkerInBounds_(a,c)&&this.addToClosestCluster_(a)},Cluster.prototype.isMarkerAlreadyAdded=function(a){if(this.markers_.indexOf)return-1!=this.markers_.indexOf(a);for(var b,c=0;b=this.markers_[c];c++)if(b==a)return!0;return!1},Cluster.prototype.addMarker=function(a){if(this.isMarkerAlreadyAdded(a))return!1;if(this.center_){if(this.averageCenter_){var b=this.markers_.length+1,c=(this.center_.lat()*(b-1)+a.getPosition().lat())/b,d=(this.center_.lng()*(b-1)+a.getPosition().lng())/b;this.center_=new google.maps.LatLng(c,d),this.calculateBounds_()}}else this.center_=a.getPosition(),this.calculateBounds_();a.isAdded=!0,this.markers_.push(a);var e=this.markers_.length;if(e<this.minClusterSize_&&a.getMap()!=this.map_&&a.setMap(this.map_),e==this.minClusterSize_)for(var f=0;e>f;f++)this.markers_[f].setMap(null);return e>=this.minClusterSize_&&a.setMap(null),this.updateIcon(),!0},Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_},Cluster.prototype.getBounds=function(){for(var a,b=new google.maps.LatLngBounds(this.center_,this.center_),c=this.getMarkers(),d=0;a=c[d];d++)b.extend(a.getPosition());return b},Cluster.prototype.remove=function(){this.clusterIcon_.remove(),this.markers_.length=0,delete this.markers_},Cluster.prototype.getSize=function(){return this.markers_.length},Cluster.prototype.getMarkers=function(){return this.markers_},Cluster.prototype.getCenter=function(){return this.center_},Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)},Cluster.prototype.isMarkerInClusterBounds=function(a){return this.bounds_.contains(a.getPosition())},Cluster.prototype.getMap=function(){return this.map_},Cluster.prototype.updateIcon=function(){var a=this.map_.getZoom(),b=this.markerClusterer_.getMaxZoom();if(b&&a>b)for(var c,d=0;c=this.markers_[d];d++)c.setMap(this.map_);else{if(this.markers_.length<this.minClusterSize_)return void this.clusterIcon_.hide();var e=this.markerClusterer_.getStyles().length,f=this.markerClusterer_.getCalculator()(this.markers_,e);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.setSums(f),this.clusterIcon_.show()}},ClusterIcon.prototype.triggerClusterClick=function(a){var b=this.cluster_.getMarkerClusterer();google.maps.event.trigger(b,"clusterclick",this.cluster_,a),b.isZoomOnClick()&&this.map_.fitBounds(this.cluster_.getBounds())},ClusterIcon.prototype.onAdd=function(){if(this.div_=document.createElement("DIV"),this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a),this.div_.innerHTML=this.sums_.text}var b=this.getPanes();b.overlayMouseTarget.appendChild(this.div_);var c=this;google.maps.event.addDomListener(this.div_,"click",function(a){c.triggerClusterClick(a)})},ClusterIcon.prototype.getPosFromLatLng_=function(a){var b=this.getProjection().fromLatLngToDivPixel(a);return"object"==typeof this.iconAnchor_&&2===this.iconAnchor_.length?(b.x-=this.iconAnchor_[0],b.y-=this.iconAnchor_[1]):(b.x-=parseInt(this.width_/2,10),b.y-=parseInt(this.height_/2,10)),b},ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+"px",this.div_.style.left=a.x+"px"}},ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},ClusterIcon.prototype.show=function(){if(this.div_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a),this.div_.style.display=""}this.visible_=!0},ClusterIcon.prototype.remove=function(){this.setMap(null)},ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),this.div_.parentNode.removeChild(this.div_),this.div_=null)},ClusterIcon.prototype.setSums=function(a){this.sums_=a,this.text_=a.text,this.index_=a.index,this.div_&&(this.div_.innerHTML=a.text),this.useStyle()},ClusterIcon.prototype.useStyle=function(){var a=Math.max(0,this.sums_.index-1);a=Math.min(this.styles_.length-1,a);var b=this.styles_[a];this.url_=b.url,this.height_=b.height,this.width_=b.width,this.textColor_=b.textColor,this.anchor_=b.anchor,this.textSize_=b.textSize,this.backgroundPosition_=b.backgroundPosition,this.iconAnchor_=b.iconAnchor},ClusterIcon.prototype.setCenter=function(a){this.center_=a},ClusterIcon.prototype.createCss=function(a){var b=[];b.push("background-image:url("+this.url_+");");var c=this.backgroundPosition_?this.backgroundPosition_:"0 0";b.push("background-position:"+c+";"),"object"==typeof this.anchor_?("number"==typeof this.anchor_[0]&&this.anchor_[0]>0&&this.anchor_[0]<this.height_?b.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):"number"==typeof this.anchor_[0]&&this.anchor_[0]<0&&-this.anchor_[0]<this.height_?b.push("height:"+this.height_+"px; line-height:"+(this.height_+this.anchor_[0])+"px;"):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"==typeof this.anchor_[1]&&this.anchor_[1]>0&&this.anchor_[1]<this.width_?b.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):b.push("width:"+this.width_+"px; text-align:center;")):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");var d=(this.textColor_?this.textColor_:"black",this.textSize_?this.textSize_:11);return b.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:red; position:absolute; font-size:"+d+"px; font-family:Arial,sans-serif; font-weight:bold"),b.join("")},google.maps.Polygon.prototype.getBounds||(google.maps.Polygon.prototype.getBounds=function(a){var b,c,d,e=new google.maps.LatLngBounds,f=this.getPaths();for(c=0;c<f.getLength();c++)for(b=f.getAt(c),d=0;d<b.getLength();d++)e.extend(b.getAt(d));return e}),google.maps.Polygon.prototype.containsLatLng=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=!1;if(2==arguments.length)"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(c=arguments[0],d=arguments[1]);else if(1==arguments.length){if(b=this.getBounds(),!b&&!b.contains(a))return!1;c=a.lat(),d=a.lng()}else console.log("Wrong number of inputs in google.maps.Polygon.prototype.contains.LatLng");for(e=this.getPaths().getLength(),f=0;e>f;f++)for(g=this.getPaths().getAt(f),h=g.getLength(),j=h-1,console.log(e,h),i=0;h>i;i++)k=g.getAt(i),l=g.getAt(j),(k.lng()<d&&l.lng()>=d||l.lng()<d&&k.lng()>=d)&&k.lat()+(d-k.lng())/(l.lng()-k.lng())*(l.lat()-k.lat())<c&&(m=!m),j=i;return m};